import math
import time

import gurobipy as gp
from gurobipy import GRB


# utils

def is_perfect_square(n):
    m = int(math.isqrt(n))
    return m * m == n


def pretty_grid(grid):
    n = len(grid)
    m = int(math.isqrt(n))
    rows = []
    cell_width = len(str(n))
    for i in range(n):
        parts = []
        for j in range(n):
            val = grid[i][j]
            # If value is 0, print a dot, otherwise print the number
            if val != 0:
                text = str(val).rjust(cell_width) 
                # rjust is just right justified within that width so it's even
            else:
                text = ".".rjust(cell_width)
            parts.append(text)
            
            # vertical separation
            if (j + 1) % m == 0 and j + 1 < n:
                parts.append("|")
        
        line = " ".join(parts)
        rows.append(line)
        
        # horizontal separation
        if (i + 1) % m == 0 and i + 1 < n:
            rows.append("-" * len(line.replace(" ", "")))
            
    return "\n".join(rows)


def validate_grid(grid):
    # Check if grid is square and values are in range
    n = len(grid)
    if n == 0:
        raise ValueError("Grid is empty")
        
    for row in grid:
        if len(row) != n:
            raise ValueError("Grid must be square")
            
    if not is_perfect_square(n):
        raise ValueError(f"Grid size {n} must be a perfect square")
        
    m = int(math.isqrt(n))
    
    for i in range(n):
        for j in range(n):
            val = grid[i][j]
            if not (0 <= val <= n):
                raise ValueError(f"Value {val} at ({i+1},{j+1}) is invalid")
                
    return n, m


# gurobi model construction

def setup_variables(data):
    n = data["n"]
    solver = data["solver"]
    original_grid = data["original_grid"]

    cells = {}  # holds gurobi variables
    costs = {}  # holds the cost for each choice

    for i in range(n):
        for j in range(n):
            original_val = original_grid[i][j]
            for k in range(1, n + 1):
                # Create a binary variable for cell (i,j) taking value k
                var_name = f"cell_{i}_{j}_{k}"
                cells[(i, j, k)] = solver.addVar(vtype=GRB.BINARY, name=var_name)
                
                # Determine cost
                if original_val == 0:
                    # It was blank, so filling it is "free" (no edit penalty)
                    costs[(i, j, k)] = 0.0
                elif k == original_val:
                    # Keeping the original value is free
                    costs[(i, j, k)] = 0.0
                else:
                    # Changing the value costs 1
                    costs[(i, j, k)] = 1.0

    data["cells"] = cells
    data["costs"] = costs


def setup_constraints(data):
    n = data["n"]
    m = data["m"]
    solver = data["solver"]
    cells = data["cells"]

    # Constraint 1: Each cell must have exactly one value
    for i in range(n):
        for j in range(n):
            # sum(cells[i,j,k] for all k) == 1
            solver.addConstr(
                gp.quicksum(cells[(i, j, k)] for k in range(1, n + 1)) == 1,
                name=f"one_value_{i}_{j}"
            )

    # Constraint 2: Each row must have each number exactly once
    for i in range(n):
        for k in range(1, n + 1):
            # sum(cells[i,j,k] for all j) == 1
            solver.addConstr(
                gp.quicksum(cells[(i, j, k)] for j in range(n)) == 1,
                name=f"row_{i}_val_{k}"
            )

    # Constraint 3: Each column must have each number exactly once
    for j in range(n):
        for k in range(1, n + 1):
            # sum(cells[i,j,k] for all i) == 1
            solver.addConstr(
                gp.quicksum(cells[(i, j, k)] for i in range(n)) == 1,
                name=f"col_{j}_val_{k}"
            )

    # Constraint 4: Each subgrid (block) must have each number exactly once
    for block_i in range(m):
        for block_j in range(m):
            # Determine range of rows and columns for this block
            row_start = block_i * m
            col_start = block_j * m
            
            for k in range(1, n + 1):
                # Sum over all cells in this block
                block_sum = gp.quicksum(
                    cells[(r, c, k)] 
                    for r in range(row_start, row_start + m)
                    for c in range(col_start, col_start + m)
                )
                solver.addConstr(block_sum == 1, name=f"block_{block_i}_{block_j}_val_{k}")


def setup_objective(data):
    solver = data["solver"]
    cells = data["cells"]
    costs = data["costs"]

    # We want to minimize the total cost of our choices
    # Total Cost = sum( cost[i,j,k] * cell[i,j,k] )
    total_cost_expr = 0
    for key in cells:
        total_cost_expr += costs[key] * cells[key]

    solver.setObjective(total_cost_expr, GRB.MINIMIZE)


def create_sudoku_model(grid, name="SudokuMinEdit"):
    n, m = validate_grid(grid)

    solver = gp.Model(name)

    # Store everything in a dictionary so we can pass it around easily
    original_grid_copy = []
    for row in grid:
        new_row = []
        for val in row:
            new_row.append(val)
        original_grid_copy.append(new_row)
    
    data = {
        "original_grid": original_grid_copy,
        "n": n,
        "m": m,
        "solver": solver,
    }

    setup_variables(data)
    setup_constraints(data)
    setup_objective(data)
    
    solver.update()
    return data


def get_solution_grid(data):
    n = data["n"]
    cells = data["cells"]
    
    solution = []
    for i in range(n):
        row = []
        for j in range(n):
            chosen_val = 0
            for k in range(1, n + 1):
                # Check if was set to 1 in the solution, we want to find the value that was chosen.
                if cells[(i, j, k)].X > 0.5:
                    chosen_val = k
                    break
            row.append(chosen_val)
        solution.append(row)
    return solution


def solve_sudoku(data, time_limit=None, quiet=False):
    solver = data["solver"]
    
    if quiet:
        solver.Params.OutputFlag = 0
    else:
        solver.Params.OutputFlag = 1
        
    if time_limit is not None:
        solver.Params.TimeLimit = time_limit

    solver.optimize()

    status = solver.Status
    if status == GRB.OPTIMAL:
        return "Optimal", get_solution_grid(data)
    elif status == GRB.TIME_LIMIT and solver.SolCount > 0:
        return "Feasible", get_solution_grid(data)
    else:
        return "No Solution", None


def find_edits(data, solved_grid):
    original_grid = data["original_grid"]
    n = data["n"]
    
    edits = []
    for i in range(n):
        for j in range(n):
            old_val = original_grid[i][j]
            new_val = solved_grid[i][j]
            
            # An edit is when a nonzero original value changes, so we can't count if the new value is the same as the original value.
            if old_val != 0 and new_val != old_val:
                edits.append((i, j, old_val, new_val))
                
    return edits


# test cases

# we have examples of trivial, chaotic, and nontrivial puzzles for order 3,4,5,6

#  implicit 9x9
# EXAMPLE_EASY = [
#     [0,2,4, 7,9,5, 0,0,3],
#     [1,0,3, 0,0,0, 0,0,4],
#     [0,7,5, 4,0,6, 0,0,2],

#     [0,0,0, 0,0,0, 2,0,6],
#     [7,5,0, 0,0,0, 1,0,9],
#     [0,4,8, 0,6,9, 0,0,0],

#     [0,9,0, 0,0,0, 0,2,0],
#     [5,0,2, 0,0,0, 0,0,0],
#     [0,0,0, 0,3,0, 0,0,0]
# ]

# # example of a 9*9 (1 on each subblock and also another 1 in the same subblock (multiple times))
# EXAMPLE_EASY = [
#     [0,0,1, 2,6,1, 7,0,1],
#     [6,8,0, 0,7,0, 0,9,0],
#     [1,9,0, 0,0,4, 5,0,0],
#     [8,2,0, 1,0,1, 0,4,0],
#     [0,0,4, 6,0,2, 9,0,0],
#     [0,5,0, 0,0,3, 0,2,8],
#     [0,0,9, 3,0,1, 0,7,4],
#     [0,4,0, 0,5,0, 0,3,6],
#     [7,0,3, 0,1,8, 0,0,0],
# ]

# # 16*16 example that's somewhat easy to solve
# EXAMPLE_EASY = [
#     [0,6,0,0, 0,14,10,0, 13,5,15,0, 0,8,0,4],
#     [7,0,10,0, 16,5,6,0, 0,0,0,0, 15,0,11,1],
#     [0,0,0,3, 1,0,12,0, 6,0,0,0, 0,16,0,0],
#     [14,0,0,0, 3,11,0,0, 10,16,1,0, 0,0,0,0],

#     [0,0,7,0, 8,0,9,14, 16,0,12,0, 5,0,4,0],
#     [6,0,0,0, 0,0,7,0, 9,0,0,1, 0,0,8,13],
#     [0,5,0,0, 0,0,0,0, 15,0,13,0, 9,7,2,12],
#     [0,8,0,2, 0,13,1,12, 14,0,10,0, 0,15,0,0],

#     [0,0,3,0, 13,7,0,6, 2,8,16,4, 1,0,12,0],
#     [4,13,5,16, 12,1,0,10, 0,0,0,0, 0,0,3,0],
#     [12,1,0,16, 14,0,0,4, 0,13,0,0, 0,0,0,8],
#     [0,9,0,7, 0,3,0,0, 1,12,0,10, 4,13,0,0],

#     [0,0,0,0, 0,0,15,0, 8,1,3,16, 0,0,0,2],
#     [0,0,6,0, 0,16,14,5, 0,15,0,13, 8,0,0,0],
#     [1,16,0,8, 0,0,0,0, 0,10,14,2, 0,4,0,9],
#     [15,0,2,0, 0,8,13,1, 0,9,6,0, 0,0,10,0]
# ]


# EXAMPLE_25_TRIVIAL = [
#     [1, 1, 0, 0, 5, 0, 0, 0, 9, 0, 0, 0, 13, 0, 0, 0, 17, 0, 0, 0, 21, 0, 0, 0, 25],
#     [0, 0, 0, 9, 0, 0, 0, 13, 0, 0, 0, 17, 0, 0, 0, 21, 0, 0, 0, 25, 0, 0, 0, 4, 0],
#     [0, 0, 13, 0, 0, 0, 17, 0, 0, 0, 21, 0, 0, 0, 25, 0, 0, 0, 4, 0, 0, 0, 8, 0, 0],
#     [0, 17, 0, 0, 0, 21, 0, 0, 0, 25, 0, 0, 0, 4, 0, 0, 0, 8, 0, 0, 0, 12, 0, 0, 0],
#     [21, 0, 0, 0, 25, 0, 0, 0, 4, 0, 0, 0, 8, 0, 0, 0, 12, 0, 0, 0, 16, 0, 0, 0, 20],

#     [0, 0, 0, 5, 0, 0, 0, 9, 0, 0, 0, 13, 0, 0, 0, 17, 0, 0, 0, 21, 0, 0, 0, 25, 0],
#     [0, 0, 9, 0, 0, 0, 13, 0, 0, 0, 17, 0, 0, 0, 21, 0, 0, 0, 25, 0, 0, 0, 4, 0, 0],
#     [0, 13, 0, 0, 0, 17, 0, 0, 0, 21, 0, 0, 0, 25, 0, 0, 0, 4, 0, 0, 0, 8, 0, 0, 0],
#     [17, 0, 0, 0, 21, 0, 0, 0, 25, 0, 0, 0, 4, 0, 0, 0, 8, 0, 0, 0, 12, 0, 0, 0, 16],
#     [0, 0, 0, 25, 0, 0, 0, 4, 0, 0, 0, 8, 0, 0, 0, 12, 0, 0, 0, 16, 0, 0, 0, 20, 0],

#     [0, 0, 5, 0, 0, 0, 9, 0, 0, 0, 13, 0, 0, 0, 17, 0, 0, 0, 21, 0, 0, 0, 25, 0, 0],
#     [0, 9, 0, 0, 0, 13, 0, 0, 0, 17, 0, 0, 0, 21, 0, 0, 0, 25, 0, 0, 0, 4, 0, 0, 0],
#     [13, 0, 0, 0, 17, 0, 0, 0, 21, 0, 0, 0, 25, 0, 0, 0, 4, 0, 0, 0, 8, 0, 0, 0, 12],
#     [0, 0, 0, 21, 0, 0, 0, 25, 0, 0, 0, 4, 0, 0, 0, 8, 0, 0, 0, 12, 0, 0, 0, 16, 0],
#     [0, 0, 25, 0, 0, 0, 4, 0, 0, 0, 8, 0, 0, 0, 12, 0, 0, 0, 16, 0, 0, 0, 20, 0, 0],

#     [0, 5, 0, 0, 0, 9, 0, 0, 0, 13, 0, 0, 0, 17, 0, 0, 0, 21, 0, 0, 0, 25, 0, 0, 0],
#     [9, 0, 0, 0, 13, 0, 0, 0, 17, 0, 0, 0, 21, 0, 0, 0, 25, 0, 0, 0, 4, 0, 0, 0, 8],
#     [0, 0, 0, 17, 0, 0, 0, 21, 0, 0, 0, 25, 0, 0, 0, 4, 0, 0, 0, 8, 0, 0, 0, 12, 0],
#     [0, 0, 21, 0, 0, 0, 25, 0, 0, 0, 4, 0, 0, 0, 8, 0, 0, 0, 12, 0, 0, 0, 16, 0, 0],
#     [0, 25, 0, 0, 0, 4, 0, 0, 0, 8, 0, 0, 0, 12, 0, 0, 0, 16, 0, 0, 0, 20, 0, 0, 0],

#     [5, 0, 0, 0, 9, 0, 0, 0, 13, 0, 0, 0, 17, 0, 0, 0, 21, 0, 0, 0, 25, 0, 0, 0, 4],
#     [0, 0, 0, 13, 0, 0, 0, 17, 0, 0, 0, 21, 0, 0, 0, 25, 0, 0, 0, 4, 0, 0, 0, 8, 0],
#     [0, 0, 17, 0, 0, 0, 21, 0, 0, 0, 25, 0, 0, 0, 4, 0, 0, 0, 8, 0, 0, 0, 12, 0, 0],
#     [0, 21, 0, 0, 0, 25, 0, 0, 0, 4, 0, 0, 0, 8, 0, 0, 0, 12, 0, 0, 0, 16, 0, 0, 0],
#     [25, 0, 0, 0, 4, 0, 0, 0, 8, 0, 0, 0, 12, 0, 0, 0, 16, 0, 0, 0, 20, 0, 0, 0, 24],
# ]


# EXAMPLE_CHAOTIC_36 = [
#     # Every row is just 1-36. 
#     # This creates 36 duplicates in every column. Maximum chaos.
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
# ]

# EXAMPLE_CHAOTIC_25 = [
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25],
#     [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25],
# ]

EXAMPLE_CHAOTIC_16 = [
    [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16],
    [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16],
    [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16],
    [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16],
    [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16],
    [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16],
    [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16],
    [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16],
    [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16],
    [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16],
    [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16],
    [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16],
    [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16],
    [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16],
    [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16],
    [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16],
]
EXAMPLE_CHAOTIC_9 = [
    [1, 2, 3, 4, 5, 6, 7, 8, 9],
    [1, 2, 3, 4, 5, 6, 7, 8, 9],
    [1, 2, 3, 4, 5, 6, 7, 8, 9],
    [1, 2, 3, 4, 5, 6, 7, 8, 9],
    [1, 2, 3, 4, 5, 6, 7, 8, 9],
    [1, 2, 3, 4, 5, 6, 7, 8, 9],
    [1, 2, 3, 4, 5, 6, 7, 8, 9],
    [1, 2, 3, 4, 5, 6, 7, 8, 9],
    [1, 2, 3, 4, 5, 6, 7, 8, 9],
]

EXAMPLE_ONE_EDIT_9 = [
    # Row 0: First value is 2 (Incorrect). Should be '1'.
    [2, 2, 3, 4, 5, 6, 7, 8, 9],
    [4, 5, 6, 7, 8, 9, 1, 2, 3],
    [7, 8, 9, 1, 2, 3, 4, 5, 6],
    [2, 3, 1, 5, 6, 4, 8, 9, 7],
    [5, 6, 4, 8, 9, 7, 2, 3, 1],
    [8, 9, 7, 2, 3, 1, 5, 6, 4],
    [3, 1, 2, 6, 4, 5, 9, 7, 8],
    [6, 4, 5, 9, 7, 8, 3, 1, 2],
    [9, 7, 8, 3, 1, 2, 6, 4, 5],
]
EXAMPLE_ONE_EDIT_16 = [
    # Row 0: First value is '2 (Incorrect). Should be '1'.
    [ 2,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16],
    [ 5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16,  1,  2,  3,  4],
    [ 9, 10, 11, 12, 13, 14, 15, 16,  1,  2,  3,  4,  5,  6,  7,  8],
    [13, 14, 15, 16,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12],
    
    [ 2,  3,  4,  1,  6,  7,  8,  5, 10, 11, 12,  9, 14, 15, 16, 13],
    [ 6,  7,  8,  5, 10, 11, 12,  9, 14, 15, 16, 13,  2,  3,  4,  1],
    [10, 11, 12,  9, 14, 15, 16, 13,  2,  3,  4,  1,  6,  7,  8,  5],
    [14, 15, 16, 13,  2,  3,  4,  1,  6,  7,  8,  5, 10, 11, 12,  9],
    
    [ 3,  4,  1,  2,  7,  8,  5,  6, 11, 12,  9, 10, 15, 16, 13, 14],
    [ 7,  8,  5,  6, 11, 12,  9, 10, 15, 16, 13, 14,  3,  4,  1,  2],
    [11, 12,  9, 10, 15, 16, 13, 14,  3,  4,  1,  2,  7,  8,  5,  6],
    [15, 16, 13, 14,  3,  4,  1,  2,  7,  8,  5,  6, 11, 12,  9, 10],
    
    [ 4,  1,  2,  3,  8,  5,  6,  7, 12,  9, 10, 11, 16, 13, 14, 15],
    [ 8,  5,  6,  7, 12,  9, 10, 11, 16, 13, 14, 15,  4,  1,  2,  3],
    [12,  9, 10, 11, 16, 13, 14, 15,  4,  1,  2,  3,  8,  5,  6,  7],
    [16, 13, 14, 15,  4,  1,  2,  3,  8,  5,  6,  7, 12,  9, 10, 11],
]


EXAMPLE_IMPLICIT_SPARSE_16 = [
    # The solver must fix (0,0) because the logic here is completely jammed.
    [ 5,  2,  3,  4,  0,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16], # Hole at 5
    [ 0,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16,  1,  2,  3,  4], # Hole at 1
    [ 9, 10, 11, 12, 13, 14, 15, 16,  1,  2,  3,  4,  5,  6,  7,  8],
    [13, 14, 15, 16,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12], # (4,5) is '1'. Conflicts with Row 1!
    [ 2,  3,  4,  1,  6,  7,  8,  5, 10, 11, 12,  9, 14, 15, 16, 13],
    [ 6,  7,  8,  5, 10, 11, 12,  9, 14, 15, 16, 13,  2,  3,  4,  1],

    # Even with all this freedom, the top trap is inescapable.
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
]
EXAMPLE_IMPLICIT_SPARSE_25 = [
    # --- BAND 1 (Rows 0-4) ---
    # The Logic Trap is locked here.
    
    # Row 0: "Liar" at (0,0). I put '6' (should be 1).
    # I cleared the real '6' at (0,5) to make it a "Silent" killer.
    [ 6,  2,  3,  4,  5,  0,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25],

    # Row 1: I cleared the '6' at (1,0) to hide the vertical conflict.
    [ 0,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25,  1,  2,  3,  4,  5],

    # Rows 2-4: Perfect valid rows. They constrain Block 1, forcing the hole above to be 6.
    [11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10],
    [16, 17, 18, 19, 20, 21, 22, 23, 24, 25,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15],
    [21, 22, 23, 24, 25,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20],

    # --- THE VOID (Rows 5-24) ---
    # 20 rows of zeros. The solver has infinite freedom here, 
    # but it cannot escape the logic trap set in the top rows.
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
]

EXAMPLE_IMPLICIT_SPARSE_36 = [
    # --- BAND 1 (Rows 0-5) ---
    # The Logic Trap is locked here.
    
    # Row 0: "Liar" at (0,0). I put '7' (should be 1).
    # I cleared the real '7' at (0,6) to make it a "Silent" killer.
    [ 7,  2,  3,  4,  5,  6,  0,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],

    # Row 1: I cleared the '7' at (1,0) to hide the vertical conflict.
    [ 0,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36,  1,  2,  3,  4,  5,  6],

    # Rows 2-5: Perfect valid rows. They constrain Block 1, forcing the hole above to be 7.
    [13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12],
    [19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18],
    [25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24],
    [31, 32, 33, 34, 35, 36,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30],

    # --- THE VOID (Rows 6-35) ---
    # 30 rows of zeros. Infinite freedom, but the trap is inescapable.
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
]

EXAMPLE_TRIVIAL_36 = [
    [1,1,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36],
    [7,0,0,0,0,0,13,0,0,0,0,0,19,0,0,0,0,0,25,0,0,0,0,0,31,0,0,0,0,0,1,0,0,0,0,0],
    [13,0,0,0,0,0,19,0,0,0,0,0,25,0,0,0,0,0,31,0,0,0,0,0,1,0,0,0,0,0,7,0,0,0,0,0],
    [19,0,0,0,0,0,25,0,0,0,0,0,31,0,0,0,0,0,1,0,0,0,0,0,7,0,0,0,0,0,13,0,0,0,0,0],
    [25,0,0,0,0,0,31,0,0,0,0,0,1,0,0,0,0,0,7,0,0,0,0,0,13,0,0,0,0,0,19,0,0,0,0,0],
    [31,0,0,0,0,0,1,0,0,0,0,0,7,0,0,0,0,0,13,0,0,0,0,0,19,0,0,0,0,0,25,0,0,0,0,0],
    [2,0,0,0,0,0,8,0,0,0,0,0,14,0,0,0,0,0,20,0,0,0,0,0,26,0,0,0,0,0,32,0,0,0,0,0],
    [8,0,0,0,0,0,14,0,0,0,0,0,20,0,0,0,0,0,26,0,0,0,0,0,32,0,0,0,0,0,2,0,0,0,0,0],
    [14,0,0,0,0,0,20,0,0,0,0,0,26,0,0,0,0,0,32,0,0,0,0,0,2,0,0,0,0,0,8,0,0,0,0,0],
    [20,0,0,0,0,0,26,0,0,0,0,0,32,0,0,0,0,0,2,0,0,0,0,0,8,0,0,0,0,0,14,0,0,0,0,0],
    [26,0,0,0,0,0,32,0,0,0,0,0,2,0,0,0,0,0,8,0,0,0,0,0,14,0,0,0,0,0,20,0,0,0,0,0],
    [32,0,0,0,0,0,2,0,0,0,0,0,8,0,0,0,0,0,14,0,0,0,0,0,20,0,0,0,0,0,26,0,0,0,0,0],
    [3,0,0,0,0,0,9,0,0,0,0,0,15,0,0,0,0,0,21,0,0,0,0,0,27,0,0,0,0,0,33,0,0,0,0,0],
    [9,0,0,0,0,0,15,0,0,0,0,0,21,0,0,0,0,0,27,0,0,0,0,0,33,0,0,0,0,0,3,0,0,0,0,0],
    [15,0,0,0,0,0,21,0,0,0,0,0,27,0,0,0,0,0,33,0,0,0,0,0,3,0,0,0,0,0,9,0,0,0,0,0],
    [21,0,0,0,0,0,27,0,0,0,0,0,33,0,0,0,0,0,3,0,0,0,0,0,9,0,0,0,0,0,15,0,0,0,0,0],
    [27,0,0,0,0,0,33,0,0,0,0,0,3,0,0,0,0,0,9,0,0,0,0,0,15,0,0,0,0,0,21,0,0,0,0,0],
    [33,0,0,0,0,0,3,0,0,0,0,0,9,0,0,0,0,0,15,0,0,0,0,0,21,0,0,0,0,0,27,0,0,0,0,0],
    [4,0,0,0,0,0,10,0,0,0,0,0,16,0,0,0,0,0,22,0,0,0,0,0,28,0,0,0,0,0,34,0,0,0,0,0],
    [10,0,0,0,0,0,16,0,0,0,0,0,22,0,0,0,0,0,28,0,0,0,0,0,34,0,0,0,0,0,4,0,0,0,0,0],
    [16,0,0,0,0,0,22,0,0,0,0,0,28,0,0,0,0,0,34,0,0,0,0,0,4,0,0,0,0,0,10,0,0,0,0,0],
    [22,0,0,0,0,0,28,0,0,0,0,0,34,0,0,0,0,0,4,0,0,0,0,0,10,0,0,0,0,0,16,0,0,0,0,0],
    [28,0,0,0,0,0,34,0,0,0,0,0,4,0,0,0,0,0,10,0,0,0,0,0,16,0,0,0,0,0,22,0,0,0,0,0],
    [34,0,0,0,0,0,4,0,0,0,0,0,10,0,0,0,0,0,16,0,0,0,0,0,22,0,0,0,0,0,28,0,0,0,0,0],
    [5,0,0,0,0,0,11,0,0,0,0,0,17,0,0,0,0,0,23,0,0,0,0,0,29,0,0,0,0,0,35,0,0,0,0,0],
    [11,0,0,0,0,0,17,0,0,0,0,0,23,0,0,0,0,0,29,0,0,0,0,0,35,0,0,0,0,0,5,0,0,0,0,0],
    [17,0,0,0,0,0,23,0,0,0,0,0,29,0,0,0,0,0,35,0,0,0,0,0,5,0,0,0,0,0,11,0,0,0,0,0],
    [23,0,0,0,0,0,29,0,0,0,0,0,35,0,0,0,0,0,5,0,0,0,0,0,11,0,0,0,0,0,17,0,0,0,0,0],
    [29,0,0,0,0,0,35,0,0,0,0,0,5,0,0,0,0,0,11,0,0,0,0,0,17,0,0,0,0,0,23,0,0,0,0,0],
    [35,0,0,0,0,0,5,0,0,0,0,0,11,0,0,0,0,0,17,0,0,0,0,0,23,0,0,0,0,0,29,0,0,0,0,0],
    [6,0,0,0,0,0,12,0,0,0,0,0,18,0,0,0,0,0,24,0,0,0,0,0,30,0,0,0,0,0,36,0,0,0,0,0],
    [12,0,0,0,0,0,18,0,0,0,0,0,24,0,0,0,0,0,30,0,0,0,0,0,36,0,0,0,0,0,6,0,0,0,0,0],
    [18,0,0,0,0,0,24,0,0,0,0,0,30,0,0,0,0,0,36,0,0,0,0,0,6,0,0,0,0,0,12,0,0,0,0,0],
    [24,0,0,0,0,0,30,0,0,0,0,0,36,0,0,0,0,0,6,0,0,0,0,0,12,0,0,0,0,0,18,0,0,0,0,0],
    [30,0,0,0,0,0,36,0,0,0,0,0,6,0,0,0,0,0,12,0,0,0,0,0,18,0,0,0,0,0,24,0,0,0,0,0],
    [36,0,0,0,0,0,6,0,0,0,0,0,12,0,0,0,0,0,18,0,0,0,0,0,24,0,0,0,0,0,30,0,0,0,0,0],
]



def main():
    start_time = time.time()
    # change this to whatever test case you're running
    grid = EXAMPLE_IMPLICIT_SPARSE_16
    print("Minimum-edit target (input puzzle)")
    print(pretty_grid(grid))

    data = create_sudoku_model(grid)
    
    status, solution = solve_sudoku(data, time_limit=None, quiet=False)

    if solution is None:
        print("Solver finished with status: " + str(status) + " (no solution found)")
        return

    # analyze results
    edits = find_edits(data, solution)

    playable_grid = []
    edited_cells = set()
    for row_idx, col_idx, old_val, new_val in edits:
        edited_cells.add((row_idx, col_idx))
        
    for i in range(len(grid)):
        row_list = []
        for j in range(len(grid)):
            # If it's a non-zero given and we didn't edit it, keep it.
            # Otherwise make it 0 (blank)
            if grid[i][j] != 0 and (i, j) not in edited_cells:
                row_list.append(grid[i][j])
            else:
                row_list.append(0)
        playable_grid.append(row_list)

    print("\nPlayable Sudoku (unchanged givens only; blanks elsewhere)")
    print(pretty_grid(playable_grid))

    print("\nRepaired Sudoku (minimum edit solution)")
    print(pretty_grid(solution))

    print("\nNumber of edited givens: " + str(len(edits)))
    if len(edits) > 0:
        print("Edits (row, col, original, new):")
        for i, j, old_val, new_val in edits:
            print("  (" + str(i+1) + ", " + str(j+1) + "): " + str(old_val) + " --> " + str(new_val))

    print("\nPlayable grid changes (only edited original givens):")
    if len(edits) == 0:
        print("  No original givens were changed.")
    else:
        for i, j, old_val, new_val in edits:
            print("  (" + str(i+1) + ", " + str(j+1) + "): " + str(old_val) + " --> blank")

    end_time = time.time()
    total_runtime = end_time - start_time
    total_runtime_rounded = round(total_runtime, 4)
    print("\nTotal runtime (seconds): " + str(total_runtime_rounded))


main()
